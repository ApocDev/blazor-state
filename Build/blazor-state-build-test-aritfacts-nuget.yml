trigger:
- master

pr: none

variables:
  Major: 1
  Minor: 0
  DotNetSdkVersion: 3.0.100

stages:
  - stage: Test_Stage
    jobs:
      - job:
        steps:
          - script: |
              echo Test_Stage
              echo Major:$(Major)
              echo Minor:$(Minor)
              echo DotNetSdkVersion:$(DotNetSdkVersion)

  - stage: Build_Stage
    variables:
      Patch: 0
      BuildCounterReset: $(Major).$(Minor).$(Patch)
      BuildCounter: $[counter(variables.BuildCounterReset, 0)]
      Version: '$(Major).$(Minor).$(Patch)-(BuildCounter)+$(DotNetSdkVersion)'
    jobs:
      - job:
        steps:
          - script: |
              echo Build_Stage
              echo Major:$(Major)
              echo Minor:$(Minor)
              echo DotNetSdkVersion:$(DotNetSdkVersion)
              echo Patch:$(Patch)
              echo BuildCounter:$(BuildCounter)
              echo Version:$(Version)

  - stage: Staging_Stage
    jobs:
      - job:
        steps:
          - script: echo Staging

  - stage: Production_Stage
    variables:
      PatchCounterReset: $(Major).$(Minor)
      Patch: $[counter(variables.PatchCounterReset, 0)]
      Version: '$(Major).$(Minor).$(Patch)-(BuildCounter)+$(DotNetSdkVersion)'
    jobs:
      - job:
        steps:
          - script: |
              echo Production_Stage
              echo Major:$(Major)
              echo Minor:$(Minor)
              echo DotNetSdkVersion:$(DotNetSdkVersion)
              echo Patch:$(Patch)
              echo BuildCounter:$(BuildCounter)
              echo Version:$(Version)